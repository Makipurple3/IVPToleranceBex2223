---
title: "BEX 2223 MAungKyaw"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
# Set global knitr options
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction


## 0.Opening the data
### Loading data

```{r LoadData, include=FALSE}

# Load knitr for  markdown outputs
library(knitr)

##Load pander for better presentation of the outputs
library(pander)

##Load dplyr for better manipulation of the data
library(dplyr)

# Load readxl package to import the data
library("readxl")

# Read xlsx files
Boxex <- read_xls("/Users/maki/Desktop/Master Thesis/BEX 2223 Master Thesis MAung Kyaw/Makipurple3/Box Experiments.xls")

``` 

* First I downloaded the **knitr package** to create outputs as html, pdf or word files when knitting my r markdown file.I also loaded nd the **pander** package for better presentation
* The **dplyr** package was installed for better manipulation of the data as filtering or creating new variables
* Then, I installed the **readxl package** to import my dataset which is called **Box Experiments.xls**
* This dataset contains information related to my master thesis project. I used cyber tracker in order to record the behaviors of dyads of Vervet monkeys in a box experiment on tolerance from September 2022 to September 2023

## 1.Explore the data

### Description of the initial datset - "Boxex"

```{r View and Glimpse of Boxex, echo=FALSE}

# First view of my datset
View(Boxex)

#GLimpse function to see the summary and  the structure

cat("Glimpse of the the Box Experiment dataset:\n\n")
glimpse(Boxex)
```



* I am now using the **glimpse** function to display a summary of my dataset
* I have **20 columns** (here variables) and **2795 rows** (here trials)

* I will now make a brief summary of each variables and their use before creating a new dataframe (df) with my variables of interest

* The highlighted variables are the ones I will use for my new df. I will then **clean the data** before heading to the **statistical analysis**


#### Variables of Boxex

* **Date**               :
    "Date" is in ac**POSIXct** format which is appropriate for the display of time 

    * I want to use the date to know **how many sessions** have been done with each dyads in my experiment. 
    * I will create a variable called **Session** where **1 session = 1 day**
    * The data has values from the **14th of September 2022** until the **13th of September 2023**
    * I may consider separating the **12 months** of data in **4 seasons** to make a preliminary check of a potential effect of seasonality. Nevertheless we did not use any tools to measure the weather,         temperature, humidity or food availability (also related to seasonality and weather). Categorizing my data in 4 without having further data would then be quite arbitrary. If I end up doing it in my          report, it will be done without any intention to include it in scientific analysis nor my scientific report .
    

    
* **Time**                  : 
     "Time is coded" in a **POSIXct** format 
     
    * I do not plan to use this variable but we can see that "Time" has hours displayed with a date which is incorrect. 
    * (In the case I wanted to observe **when the trials occurred during the day** as time may have an influence on their behavior) **SOURCE**I would need to correct the incorrect display of the date in the     dataset.
    * This variable could also be usefull to see when  the **seasonal effect** took place as we only went in the morning during summer because of the heat while we went later and for longer times in the          field to do the box experiment in winter 
    * For now, the values in "Time" are all on the same (wrong) day which is the **31st  of December** 
    * Nevertheless I am not going to use this variable
    
    
* Data                   : chr 
    "Data" is coded as **character**
    * It describes **the type of data** being recorded in the software **cybertracker**. We installed the software on tablets to record the different behaviors of vervet monkeys in our research center
    * In our case, my data was recorded in cybertracker as **Box Experiment** as we created a form specifically for this experiment
    * For this reason we can remove this column as the information is unecessary
      
* Group             : chr 
    The data is coded in r as a **character**
    * It describes the **group of monkey** in which we did the trial
    * I will keep this column to see theamount of trials that we did in the 3 group of monkeys which are Baie-Dankie **(BD)**, Ankhase **(AK)**, and Noha **(NH)**
      
* GPSS                   : num 
    "GPSS" is coded as **numerical**
    * It gives the **south coordinates** in which we started the experiment
    * I do not plan to use coordinates nor look at locations so I will remove this acolumn
    
* GPSE                   : num 
    "GPSE" is coded in as **numerical**
    * It gives the **east coordinates** in which we started the experiment
    * I do not plan to use coordinates nor look at locations so I will remove this column
  
* **MaleID**             : chr 
    "MaleID" is coded as **character**
    * It gives the **name of the male involved in the trial**
    * I plan to use this to see how factors related to the individual may influence the            experiment (age, sex, rank)
    * It will also help me see which behaviour was displayed by each individuals (here males)
  
  
* **FemaleID**           : chr
    "FemaleID" is coded as **character**
    * It gives the **name of the female involved in the trial**
    * I plan to use this variable in the same way as "Male ID"
    * It will also help me see which behaviour was displayed by each individuals (here females)
    
  
  
* **Male placement corn**: dbl
    "Male placement corn is coded in r as **double**
    * It gives the **amount of corn given to the monkey of the dyad before the trials**
    * Within a session it happened that we gave more placement corn to attract the monkeys again to the boxes. This lead to an update of the number in the same session. The number found at the end of the         session is the total placement corn an individual has received
    * I will fuse this column with **male corn***as the data has been separated between these two variables. This is due to a mistake when creating the original box experiment form in cybertracker
    
    * This variable could be related to the level of motivation of a monkey but as it is not directly related to my hypothesis I may not use this column. I will re-consider the use of this column later on
    * In regards of this possibility I will change the format of the variable to numerical 
  
  
* **MaleCorn**           : dbl
    "MaleCorn" is coded in r as **double**
    * It gives the same information as in ***male placement corn***
    * I will import the values from "male placement corn" into this one
    * I will change the format of the variable to numerical 
    
    
* **FemaleCorn**         : dbl
    The data is coded in r as **double**
    * It gives the **amount of corn given to the monkey before the trials**
    * It works in the same way as "male placement corn"/"MaleCORN"
    * I will change the format of the varaible to numerical 
  
  
* **DyadDistance**       : chr 
    The data is coded in r as **character**
    * I gives the **distance for each trial** we have done with the dyads. 
    * The trial number 1 for each dyad was at 5 meters. 
    * The maximum was around 10 m while the minimum is 0
    * We will have to remove the "m" for meters in order to have a numerical variable insterad of character
    
  
* **DyadResponse**       : chr 
    The data is coded in r as **character**
    * It gives the code of **the behaviour produced by each dyad per trial**
    * The different behaviours were: **Distracted**, **Female aggress male**, **Male aggress female**, **Intrusion**, **Loosing interest**, **Not approaching**, **Tolerance** and **Other**
    * I will change the columns associated to each behavior (i.e. Response) of  **DyadResponse**    into dichotomic variables in order to see the frequency of each behaviour
    * This will allow me to see which behavior occured more than others, and what differences are between dydads 
    * As multiple response could occur within the same trial, multiple behaviors can be found in a single cell. I will create a  hierarchy to reduce the amount of behaviors assigned to each trial (if  there     is more than one). This will also be complemented with the information found in the column comments
      1. correct any mistakes (ex. if tolerance and aggression are together aggression>tolerance)
      2. assign as few labels per trial 
      3. get a better view and understanding of the data and the most common behaviours produced by each dyad
      4. create variables that can complement the behaviour found (ex. not approaching + looks at partner would be looks at partner + a new variable called hesistant to see when the did not come but look at         the other individual / )
      
    * Projection of the hierarchy (changes will be made)
      - Create a table with each combination existing
      
      - Decide what is more important
      - Ex:
        - Aggression > Tolerance
        - Tolerance > Not approaching -> Create a variable called hesistant in         addtion to the tolerance count to see frequency of tolerance                 behaviour that happened after > 1min
        - Tolerance > Loosing interest
        - Tolerance > Intrusion
        - Not approaching = looking box but not coming while Loosing interest           = not paying attention to the box
        - Intrusion > Loosing interest
        - Intrusion > Not approaching
        - Not approaching > Looks at partner
        - We can code every look at partner as no approaching and keep the             count of looks at partner as additional information
        - Not approaching >?> Loosing interest ? !!
        - Define distracted
        - Not approaching > Distracted
        - Aggression > Not approaching
        - Other > Look case by case and categorize depending of behavior
        - Remarks may be used for the same reason
        
  
* **OtherResponse**      : chr 
    "The data"OtherResponse" is coded as **character**
    * It describes **Any behaviour that is not included in the  ones from Dyad Response**     (meaning ≠ tolerance, aggression, intrusion, loosing interest, not approaching, distracted)
    * I will have to look at every **OtherResponse** and rename each entry in one of the response already if exstiting. I will proceed case by case.
    * If I want to do an intermediate manipulation I may rename every NA in "OtherResponse" into **Response** to see the amount of case to treat and how many occurences seem to not fit in the categories of        "DyadResponse"
    
* **Audience**      : chr 
    "Audience" is r as **character**
    * It gives the **names of the individuals in the audience**
    * I would like to use it to see the **amount of audience (big vs small)**     and the **dominance level of the audience (high vs low)** 
    * I will create a variable called **NAudience** to see hoy many individuals are in the audience for each trial
    * After calculating the elo ratings of the individuals using another dataset (Life history), I will create a dichotomic variable called **RankAudience** to see effects related to rank with the effect of audience
    
* **IDIndividual1**      : chr 
    "IDIndividual1" is coded in r as **character**
    * It gives the **names of the individuals that did not approach, show aggression or lost interest** during a trial
    * I will have to look at it to see how often these behaviors occurred
    * I will consider how to use this variable during the cleaning of the data
    
* **IntruderID**         : chr 
    "IndtruderID" is coded as **character**
    * It gives the **name of the individual that did an intrusion during a trial**
    * Intrusion could mean, invade the space of the experiment and interact with one of our individual, steal the food, show agnostic behavior, stand in very close proximity of the other individual
    * I will have to check if there is a rule (ex. each intrsuion = no corn/tolerance, or if it depends from case to case)
    
* **Remarks**            : chr 
    The data is coded in r as **character**
    * It gives supplementary information concerning the experiment when unusual behaviors occurred or when we considered adding informations on the trial was necessary
    
* Observers               .chr
    The data is coded in r as **character**
    * It gives the **names of the observers during the experiment**
    * We will not use this data as we do not look at the effect that an experimenter would have on the monkeys
    * (Should I still look at an effect of the amount of experimenter?...maybe better for detailled analysis of our study)
    
* DeviceID             .chr
    "The data "DeviceID" is coded in r as **character**
    * It gives the **name of the device/tablet** used to record the data during the experiment
    * We will not use this data either
    
    


## 2. Cleaning the data

### Creating a new dataframe
* Since I do not want to work with the whole dataset, I'm gonna select the variables of interest using the function **select**

* I will keep Date, Group, MaleID, FemaleID, MaleCorn, Male placement corn, FemaleCorn, DyadDistance, DyadResponse, OtherResponse, Audience, IDIndividual1, IntruderID, Remarks

```{r Bex Df, echo=FALSE} 
Bex<-Boxex%>%
  select(Date,Group, MaleID, FemaleID, MaleCorn,`Male placement corn`, FemaleCorn, DyadDistance, DyadResponse, OtherResponse, Audience, IDIndividual1, IntruderID, Remarks )
glimpse(Bex)

View(Bex)
```

### Merging Male placement corn and MaleCorn
* I want to process all the missing data in Bex. But before I will merge the column **MaleCorn** and **Male placement corn** as the data of both columns is supposed to be together under "MaleCorn"
* Looking manually in the Bex table it seems that very few data is in **MaleCorn** while most of it seems to be in **Male placement corn**
* Every time there is a missing value un Male placement corn we can see a value in Male Corn, I will then create a new variable MaleCorn where every time that there NA in male placement corn the value will be taken in MaleCornOld (previous malecorn). If there is no NA it will take the value of ´Male placement corn´
* I will first rename MaleCorn to MaleCornOld and proceed

```{r rename MaleCorn to MaleCornOld, include=FALSE}

# Rename MaleCorn to MaleCornOld
names(Bex)[names(Bex) == "MaleCorn"] <- "MaleCornOld"

# Check the structure of Bex to confirm the changes
str(Bex)

```

*Now before merging MaleCornOld and Male placement corn I will check the amount of NA's in both column

```{r NA Check in Male Corn variables, include=FALSE}
# Check for missing values in MaleCornOld
NA_MaleCornOld <- Bex[is.na(Bex$MaleCornOld), ]
View(NA_MaleCornOld)

# Check for missing values in Male placement corn
NA_MalePlacementCorn <- Bex[is.na(Bex$`Male placement corn`), ]
View(NA_MalePlacementCorn)

# Check the intersection of rows with NA in MaleCornOld and Male placement corn and display them
Cross_NA <- Bex[is.na(Bex$MaleCornOld) & is.na(Bex$`Male placement corn`), ]
View(Cross_NA)


# Check the amount of NA's that will be transformed to 0
common_NA_data <- Bex[Bex$Date %in% as.Date(common_NA_rows), ]
View(common_NA_data)


```





* When fusing MaleCornOld and Male placement corn, I will put different conditions
* First, I want my code to retreive the data per column for each and take the value that is different than NA. If there is a row a value in MaleCornOld and NA in male placement corn it will take the value in MaleCornOld and if the missing value is in MaleCornOld it will take the value in Male placement corn
* Also if there is no value for both MaleCornOld and Male placement corn for a given row, I would like the code to display 0 as it means that no placement was given
* In this way, I should not loose any data, minimize the mistakes and already transform the NA's of this variable into a number which will be usefull for further operations

```{r Fuse MaleCornOld and male placement corn into MaleCorn, include=FALSE}
# Create a new variable MaleCorn
Bex$MaleCorn <- ifelse(is.na(Bex$`Male placement corn`), Bex$MaleCornOld, Bex$`Male placement corn`)
Bex$MaleCorn <- ifelse(!is.na(Bex$MaleCornOld) | !is.na(Bex$`Male placement corn`), coalesce(Bex$MaleCornOld, Bex$`Male placement corn`), 0)


# Check the structure of Bex to confirm the changes
str(Bex)

# Remove the original MaleCornOld and Male placement corn
Bex$MaleCornOld <- Bex$`Male placement corn` <- NULL


# Check for missing values in the new MaleCorn
NA_MaleCorn <- Bex[is.na(Bex$MaleCorn), ]
View(NA_MaleCorn)

```


* In this code, a new variable MaleCorn is created. If there is a missing value in Male placement corn, it takes the corresponding value from MaleCornOld; otherwise, it takes the value from Male placement corn.


### Replacing and removing NA’S

```{r Find Missing data, echo=FALSE}
# Check for missing data
missing_data <- sapply(Bex, function(x) sum(is.na(x)))

# Print missing data
cat("Variables with Missing Data:\n")
print(missing_data[missing_data > 0])

cat("\nVariables with No Missing Data:\n")
print(missing_data[missing_data == 0])
  
```

   * I want to use the date to know **how many sessions** have been done with each dyads in my experiment. 
    * I will create a variable called **Session** where **1 session = 1 day**
    * The data has values from the **14th of September 2022** until the **13th of September 2023**
    * I may consider, in parallel of my hypothesis, to separate the data in *4 seasons* to make a preliminary check of a potential effect of seasonality. Nevertheless the fact that we did not use anywithout      tools to mesure the weather and the idea to make a categorization in 4 seasons without considering the actua quite arbitrary. I may do it but with no intention to include this in my scientific report.
    l temperature, food quantitiy and other elements related to seasonailty make this categorizationn a categorization where 12 months of          data will be separated in 4 categories
   


* But before I may want to make a few changes already by merging **Male corn** and **Male placement corn** into " Male corn" and maybe replacing all of the NA's in "Other response" by response






5. **Handling Missing Data:**

   - Checked for missing values in different Female and Male ID

    ```{r FemMal ID NA, echo=FALSE}
   
   # Missing values in FemaleID
   View(Boxex[is.na(Boxex$FemaleID), ])

   # Missing values in MaleID
   View(Boxex[is.na(Boxex$MaleID), ])
   
    ```

6. **Replacing Missing Values:**
   - Replaced missing values in `MaleID` and `FemaleID` columns with specified values.

   
    {r replace NA FemMalID, echo=false} 
   
   replace_rows <- c(1699, 1700, ..., 2675)
   Bex$MaleID[replace_rows] <- "Pom"
   Bex$FemaleID[replace_rows] <- "Xian"
    

7. **Handling NAs in Specific Columns:**
   - Checked and replaced NAs in specific rows and columns.

    ```{r replace NA FemID, echo=FALSE} 
   # Replace NAs in FemaleID based on row numbers
   replace_rows <- c(865:879, 1827:1839, 1913:1914, 2665:2675)
   Bex$FemaleID[replace_rows] <- c("Ndaw", "Sirk", "Oort", "Oerw")
    ```

8. **Replacing NAs in Male Corn with 0:**
   - Replaced NAs in `MaleCorn` and `FemaleCorn` columns with 0.

    ```{r replace NA Male Corn, echo=FALSE} 
   Bex$MaleCorn[is.na(Bex$MaleCorn)] <- 0
   Bex$FemaleCorn[is.na(Bex$FemaleCorn)] <- 0
    ```
   

9. **Resolving Issues:**
   - Discussed and resolved various issues related to data import, formatting, and error messages.

10. **Printing Summary:**
    - Provided a summary of the steps and code snippets for reference.

Please note that the code snippets may need to be adapted to your specific data and requirements. Let me know if you have any specific questions or if there's anything else you'd like assistance with!




#########

# Glossary
* **Tolerance**: Tolerance: An individual has an encounter with a conspecific and
  can freely leave but remains in the encounter without acting aggressively
  toward the conspecific. (Pisor & Surbeck, 2019)
* **Agression**
* **Session** 
* **Trial**
* **Group**: In the Primate order, groups are individuals “which remain [physically] together in or separate from a larger unit” and interact with each other more than with other individuals.6 This            definition does not cover all uses of the word “group” in the social sciences (e.g., human identity groups who identify with a common name or symbol may or may not interact with one another more frequently   than with other individuals). Because of this ambiguity, we use the word “community” when referring to humans to better capture the notion of spatial proximity, per Ref. 54. Members of the same group are    referred to as “same-group” and those from another group “extra-group.” (Pisor & Surbeck, 2019)


# Bibliography
 •	Pisor, A. C., & Surbeck, M. (2019). The evolution of intergroup tolerance in nonhuman primates and humans. Evolutionary Anthropology: Issues and Reviews. Advance online publication. https://doi.org/10.1002/evan.21793
(Pisor & Surbeck, 2019)



# Annex

#### Annex 1 : View of the dataset when imported - First 6 entries of each variable 
* We can see here the brief view of the **original dataset** names **BoxEx**when i initially imported it as seen in **section 0: Opening data** 



```{r View of the data Boxex, echo=FALSE}

# Display the original dataset that is name Boxex
pander(head(Boxex), style = "rmarkdown", caption = "First Few Entries") 

```